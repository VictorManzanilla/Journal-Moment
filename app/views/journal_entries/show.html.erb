<p style="color: green"><%= notice %></p>

<h2>Journal Entry</h2>
<div class="container py-5 text-light" style="background-color: #0d1a2f;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <%= link_to "â† Back", journal_entries_path, class: "btn btn-outline-light" %>
    <%= button_to "Destroy", @journal_entry, method: :delete, form: { data: { turbo_confirm: "Are you sure?" } }, class: "btn btn-outline-danger" %>
  </div>

  <hr class="border-light opacity-50">

  <h2 class="display-5 text-center mb-4">Journal Entry</h2>

  <%= turbo_frame_tag @journal_entry do %>
    <div class="card bg-dark text-light border-secondary">
      <div class="card-body">
        <p class="card-text fs-5">
          <strong>Title:</strong> <%= @journal_entry.title %>
        </p>
        <p class="card-text fs-5">
          <strong>Content:</strong> <%= @journal_entry.content %>
        </p>
        <p class="card-text fs-5">
          <strong>Mood:</strong> <%= @journal_entry.mood_label %>
        </p>

        <div class="mt-4 text-center">
          <%= link_to "âœï¸ Edit", edit_journal_entry_path(@journal_entry), 
              data: { turbo_frame: dom_id(@journal_entry)}, class: "btn btn-outline-primary" %>
        </div>
      </div>
    </div>
  <% end %>

<hr>

<h2>Conversation with AI</h2>

<!-- Toggle btn -->
<button id="toggle-ai">ðŸ’¬ Ask AI</button>

<!-- Conversation -->
<div id="ai-conversation" style="display: none;">
  <div class="messages">
    <% @messages.each do |msg| %>
      <p>
        <strong><%= msg.sender.capitalize %>:</strong>
        <%= msg.content %>
      </p>
    <% end %>
  </div>

  <!--AI form-->
  <%= form_with url: journal_entry_conversation_ais_path(@journal_entry), method: :post, local: true do %>
    <%= text_area_tag :content, nil, placeholder: "Type your message..." %>
    <%= submit_tag "Send to AI" %>
  <% end %>
</div>
<!--Container end -->
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggleBtn = document.getElementById("toggle-ai");
    const convoBox = document.getElementById("ai-conversation");

    toggleBtn.addEventListener("click", () => {
      if (convoBox.style.display === "none") {
        convoBox.style.display = "block";
        toggleBtn.innerText = "âœ– Close AI Chat";
      } else {
        convoBox.style.display = "none";
        toggleBtn.innerText = "ðŸ’¬ Ask AI";
      }
    });
  });
</script>
